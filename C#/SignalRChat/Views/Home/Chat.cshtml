@{
    ViewBag.Title = "Chat";
}
<h2>Chat</h2>
<div class="container">

    <input type="hidden" id="displayname" />
    <div id="content" class="content">
        <ul id="discussion"></ul>
    </div>

</div>
<div id="form" class="form">
    <input class="input"  type="text"   id="message"     name="content"     placeholder="message..." autocomplete="off">
    <input class="submit" type="button" id="sendmessage" name="text"        value="send">
</div>

<style>
    .container{
        padding-left: 0px;
        padding-right: 0px;
    }
    
        .form {
            position: relative;
            width: 100%;
            height: 30px;
            margin: 0;
            padding: 0;
            border: 1px solid #eee;
            border-top: 0;
            padding-right: 70px;
        }

        .input {
            border: 0;
            margin: 0;
            padding: 0px 10px;
            width: 100%;
            height: 100%;
            display: block;
            line-height: 30px;
            background: transparent;
        }

        .submit {
            float: right;
            position: absolute;
            top: 0;
            right: 0;
            width: 70px;
            height: 100%;
            border: 0;
            border-left: 1px solid #eee;
            color: #eee;
            background-color: transparent;
            margin: 0;
            padding: 0;
            display: block;
            height: 100%;
            line-height: 30px;
        }

    .content {
        padding-left: 0px;
        padding-right:0px;
        list-style-type: none;
        width: 100%;
        overflow-y: scroll;
        border: 1px solid #eee;
        margin: 0;
        display: block;
        overflow-y: scroll;
        word-wrap: break-word;
        white-space: pre-wrap;
        white-space: -moz-pre-wrap;
        white-space: -pre-wrap;
        white-space: -o-pre-wrap;
        max-height: calc(100% - 75px);
    }
</style>

@section scripts {
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.0.3.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.-->
    <script>
        $(function () {
            // Reference the auto-generated proxy for the hub.
            var chat = $.connection.chatHub;
            // Create a function that the hub can call back to display messages.
            chat.client.addNewMessageToPage = function (name, message) {
                // Add the message to the page.

                $('#discussion').append('<li>' + htmlEncode(name)
                    + ': ' + htmlEncode(message) + '</li>');
                $("#content").height(window.innerHeight - 300);
                $("#content").scrollTop($("#content")[0].scrollHeight);
            };

            $(window).resize(function () {
                $("#content").height(window.innerHeight - 300);
            });

            var instanced = false;
            
            // Get the user name and store it to prepend to messages.
            $('#displayname').val("docKatze");
            // Set initial focus to message input box.
            $('#message').focus();
            // Start the connection.
            $.connection.hub.start().done(function () {
                if (instanced == false) {
                    instanced = true;
                    chat.server.foo();
                }

                $("#message").keyup(function (event) {
                    if (event.keyCode == 13) {
                        $("#sendmessage").click();
                    }
                });


                $('#sendmessage').click(function () {
                    chat.server.onconnection

                    // Call the Send method on the hub.
                    chat.server.send($('#displayname').val(), $('#message').val());
                    // Clear text box and reset focus for next comment.
                    $('#message').val('').focus();
                });
            });
        });
        // This optional function html-encodes messages for display in the page.
        function htmlEncode(value) {
            var encodedValue = $('<div />').text(value).html();
            return encodedValue;
        }
    </script>
}